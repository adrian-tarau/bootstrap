<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:component="https://net.microfalx/component">
<body>

<thead class="table-light" th:fragment="grid-header">
<tr>
    <th scope="col" class="text-right">#</th>
    <th scope="col" th:each="field : ${#dataset.getFields()}" th:class="${#dataset.getHeaderClass(field)}"
        th:attr="field=${field.name}" component:tooltip="${field}">
        <span th:if="${field.labelIcon}" th:class="${field.labelIcon}"></span><span th:utext="${field.label}"></span>
    </th>
    <th scope="col" class="text-center" th:if="${#dataset.hasActions}" component:tooltip-text="The actions available to interact with records">Actions</th>
</tr>
</thead>

<tr th:fragment="grid-row" th:class="${#dataset.getPrimaryRowClass(model)}">
    <td class="text-right" th:text="${#dataset.getCurrentIndex()}"></td>
    <td th:each="field : ${#dataset.getFields()}" th:class="${#dataset.getCellClass(field)}">
        <span th:unless="${field.isName()}" th:utext="${#dataset.getDisplayValue(model, field)}"></span>
        <a th:if="${field.isName()}" href="#" th:attr="onclick=|Application.action('dataset.view', '${#dataset.getId(model)}')|"
           th:utext="${#dataset.getDisplayValue(model, field)}"></a>
    </td>
    <td class="text-center" th:if="${#dataset.hasActions}">
        <a class="icon-link" href="#" th:attr="onclick=|DataSet.showActions(event, '${#dataset.getId(model)}')|"><i
                class="fa-solid fa-ellipsis"></i></a>
    </td>
</tr>

<tr th:fragment="grid-row-detail" th:if="${#dataset.hasDetails()}" th:class="${#dataset.getDetailsRowClass(model)}">
    <td>&nbsp;</td>
    <td th:colspan="${#dataset.getFields().size()}">
        <div th:replace="~{ ${detailTemplate} :: ${detailFragment}}"></div>
    </td>
</tr>

<div th:fragment="grid-rows" th:each="model : ${#dataset.getModels()}" th:remove="tag">
    <tr th:replace="~{ fragments/dataset :: grid-row}"></tr>
    <tr th:replace="~{ fragments/dataset :: grid-row-detail}"></tr>
</div>

<tbody th:fragment="grid-body">
    <div th:each="model : ${#dataset.getModels()}" th:remove="tag">
        <tr th:replace="~{ fragments/dataset :: grid-row}"></tr>
        <tr th:replace="~{ fragments/dataset :: grid-row-detail}"></tr>
    </div>
</tbody>

<table id="dataset-grid" class="table table-hover dataset-table" th:fragment="grid">
    <thead th:replace="~{ fragments/dataset :: grid-header}"></thead>
    <tbody th:replace="~{ fragments/dataset :: grid-body}"></tbody>
</table>

<div class="dropdown-menu" th:fragment="action-menu" id="dataset-actions">
    <a href="#" class="dropdown-item" th:each="action : ${#component.getChildren(actions)}"
       th:attr="onclick=|Application.action('${action.action}')|" component:tooltip="${action.description}">
        <i th:class="${action.icon}"></i><span th:text="${action.text}" class="ms-2"></span></a>
</div>

<nav class="navbar navbar-expand-lg bg-body-tertiary mB-5" th:fragment="toolbar">
    <div class="container-fluid">
        <div class="collapse navbar-collapse">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                <button th:each="button : ${#component.getChildren(toolbar)}" type="button"
                        component:tooltip="${button}"
                        th:attr="onclick=|Application.action('${button.action}')|"
                        th:class="${#component.getCssClass(button,'btn btn-primary btn-color mR-5')}">
                    <i th:class="${button.icon}"></i><span class="mL-5" th:text="${button.text}"></span>
                </button>
            </ul>
            <div class="dataset-drop-zone"></div>
            <div class="mR-10">
                <span id="page_info" class="badge rounded-pill bg-success p-10" th:text="${#dataset.getPageInfo()}"
               component:tooltip-text="Displays the number of pages and number of records available using the current filter"></span>
            </div>
            <form class="d-flex" role="search" th:attr="onsubmit='return DataSet.search()'">
                <div id="daterange" th:if="${hasTimeRange}" class="form-control me-2 text-nowrap"
                     style="background: #fff; cursor: pointer; padding: 5px 10px; border: 1px solid #ccc; width: 100%"
                     component:tooltip-text="A time interval used to restrict the number of records">
                    <i class="fa fa-calendar"></i>&nbsp;
                    <span></span> <i class="fa fa-caret-down"></i>
                    <span class="d-none" th:text="${daterange}"></span>
                </div>
            </form>
        </div>
    </div>
    <iframe id="dataset-download" class="d-none"></iframe>
    <p id="dataset-message" class="d-none" th:if="${message}" th:utext="${message}"></p>
</nav>

<div class="ta-c bdT w-100 p-20" th:fragment="grid-next-page" th:if="${#dataset.hasNext()}">
    <span id="page_info_and_records" class="badge rounded-pill bg-success p-10"
          th:text="${#dataset.getPageAndRecordInfo()}"></span>
    <a id="more_results" href="#" th:data-page="${#dataset.getNextPage()}"
       th:onclick="DataSet.loadPage(this.getAttribute('data-page')); return false">
    <span class="badge bgc-green-50 c-green-700 p-10 tt-c rounded-pill">
        More results
    </span>
    </a>
</div>

<div th:fragment="render">
    <div class="col-md-12">
        <div class="bgc-white bd bdrs-3 p-20 mB-20">
            <div>
                <h3 class="c-grey-900">
                    <span th:text="${dataset.name}"></span>
                    <span th:if="${#help.hasHelp()}" class="float-end p-2">
                        <a href="#" th:attr="onclick=|Help.open('${dataset.name}','${#help.getHelp()}')|" component:tooltip-text="Opens the documentation for the current dashboard">
                            <i class="fa-solid fa-circle-question text-primary"></i>
                        </a>
                    </span>
                </h3>
                <nav th:replace="~{ fragments/dataset :: toolbar}"></nav>
            </div>
            <table th:replace="~{ fragments/dataset :: grid}"></table>
            <div th:replace="~{ fragments/dataset :: grid-next-page}"></div>
        </div>
    </div>
</div>

<div th:fragment="dialog" id="dataset-modal" tabindex="-1"
     th:class="|modal fade ${viewClasses}|" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" th:text="${dataset.name}"></h5>
            </div>
            <div class="modal-body">
                <form id="dataset-form" novalidate autocomplete="off">
                    <div th:replace="~{ ${fieldsTemplate} :: ${fieldsFragment}}"></div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" th:attr="onclick=|DataSet.save()|" th:unless="${#dataset.isView()}">Save</button>
                <button type="button" class="btn btn-secondary" th:attr="onclick=|Application.closeModal()|" th:unless="${#dataset.isView()}">Cancel</button>
                <button type="button" class="btn btn-secondary" th:attr="onclick=|Application.closeModal()|" th:if="${#dataset.isView()}">Close</button>
            </div>
        </div>
    </div>
</div>

<div th:fragment="fields" class="mb-1 row" th:each="field : ${#dataset.getFields()}">
    <label th:attr="for=${field.name}" th:class="${#dataset.getInputLabelClass(field)}" th:text="${field.label}"></label>
    <div th:class="${#dataset.getInputContainerClass(field)}">
        <input th:if="${#dataset.isInputField(field)}" th:name="${field.name}"
               th:type="${#dataset.getInputType(field)}" th:class="${#dataset.getInputFieldClass(field)}"
               th:readonly="${#dataset.isReadOnly(field)}" th:disabled="${#dataset.isDisabled(field)}" th:checked="${#dataset.isChecked(model, field)}"
               th:value="${#dataset.getValue(model, field)}">
        <input th:unless="${#dataset.isVisible(field)}" type="hidden" th:name="${field.name}"
               th:value="${#dataset.getValue(model, field)}">
        <div th:if="${#dataset.isCheckboxField(field)}" class="form-check">
            <input th:name="${field.name}" th:type="${#dataset.getInputType(field)}" th:class="${#dataset.getInputFieldClass(field)}"
                   th:readonly="${#dataset.isReadOnly(field)}" th:disabled="${#dataset.isDisabled(field)}" th:checked="${#dataset.isChecked(model, field)}">
        </div>
        <textarea th:if="${#dataset.isTextAreaField(field)}" th:name="${field.name}"
                  th:class="${#dataset.getInputFieldClass(field)}" th:readonly="${#dataset.isReadOnly(field)}" th:disabled="${#dataset.isDisabled(field)}"
                  th:attr="rows=${#dataset.getInputRows(field)}"
                  th:text="${#dataset.getValue(model, field)}"></textarea>
    </div>
</div>

</body>
</html>

